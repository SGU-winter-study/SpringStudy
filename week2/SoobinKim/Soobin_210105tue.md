# 싱글톤 컨테이너

## 웹 애플리케이션과 싱글톤
고객이 요청을 할 때마다 동일한 객체를 계속해서 생성하게 되는 문제 발생. 특히 '웹 애플리케이션'은 고객의 요청을 계속해서 처리하는 것이 주 목적이기 때문에 불필요한 객체 생성이 너무 많이 일어나게 될 수도 있다. 이를 해결하기 위해 싱글톤 패턴 디자인을 이용한다.

## 싱글톤 패턴
**싱글톤 패턴**이란 클래스의 인스턴스가 딱 한 개만 생성되는 것을 보장하는 디자인 패턴이다. 즉 하나의 Java 서버 내에서 동일한 객체가 두 개 이상 존재해서는 안 되는 것이다.
* 해당 클래스 내부에 private 변수로 static 영역에 미리 자기 자신을 정의하여 하나 생성하고,
* 생성한 객체에 대한 조회를 할 수 있는 메소드를 하나 만들어, 이 메소드를 통해서만 해당 객체에 접근할 수 있도록 한다.
* 마지막으로, 생성자를 private으로 막아둔다.

이렇게 하면 해당 객체를 생성할 수 있는 곳은 아무데도 없다. 즉, 다른 곳에서 이 객체를 계속 생성해냄으로써 중복되는 객체가 생겨나는 것을 방지한다.
즉, 한 번 생성한 객체에 대하여 해당 객체 인스턴스에 대한 요청을 할 때 **++항상 같은 인스턴스를 반환++**하게 된다. (비용이 훨씬 줄어들게 된다.)

Spring을 사용하면 기본적으로 스프링이 모든 객체들을 스프링 컨테이너 내에서 싱글톤으로 관리해준다.

싱글톤 패턴이 항상 좋은 것만은 아닌데, 대표적인 문제점들은 다음과 같다. (안티 패턴으로 불리기도 함)
1. 코드가 많이 들어가게 된다.
2. 클라이언트가 구체 클래스에 의존하게 되어 DIP, OCP를 위반한다.
3. 테스트가 어렵다.
4. 내부 속성 변경 또는 초기화가 어렵다.
5. private 생성자를 이용하기 때문에 자식 클래스를 만드는 것이 어렵다.
6. 유연성이 떨어진다.

## 싱글톤 컨테이너(=스프링 컨테이너)
앞서 언급했듯, 스프링은 스프링 컨테이너 내에서 모든 객체들을 싱글톤으로 관리한다. 그러나 싱글톤패턴은 안티패턴으로 불리기도 할 만큼 꽤 많은 문제를 가지고 있는데, 스프링은 싱글톤의 장점은 극대화하고 단점 및 문제점들은 극소화해준다.

이는 스프링 컨테이너가 '싱글톤 패턴' 자체를 이용하는 것이 아니라, 스프링 컨테이너 생성 과정에서 객체를 '싱글톤'으로 관리할 뿐이기 때문에 가능하다.
이 덕분에 싱글톤 패턴에서 싱글톤을 유지하기 위해 추가했던 여러 줄의 코드가 불필요해지고, private 생성자가 없어도 되기 때문에 보다 더 유연해진다. (DIP, OCP도 따를 수 있다.)

이렇게 객체를 싱글톤 방식으로 관리하는 스프링 컨테이너의 특징 덕분에, 고객의 요청이 올 때마다 새로운 객체를 만들 필요 없이(굉장히 큰 낭비 발생) == 이미 생성되어있는 객체를 공유하여 효율적으로 재사용 == 한다.

## 싱글톤 방식의 주의점
싱글톤 객체는 모든 클라이언트에 의해서 공유되기 때문에 stateful해서는 안 된다.
즉, **무상태(stateless)**여야 한다. ★

- 특정 클라이언트에게 종속되는 필드가 존재해서는 안 된다.
- 클라이언트에 의해 값이 변경되는 필트가 존재해서는 안 된다.
- 읽기만 가능한 것이 좋다.

어떠한 싱글톤 객체 x에 대하여, 사용자 A가 x의 상태를 바꿔놓으면 이후 사용자 B가 자신이 바꾼 적이 없는데도 A에 의해 바뀐 x를 그대로 공유하기 때문에 잘못된 값을 사용하게 된다(특히 multithread 환경에서 예상하지 못한 결과 발생 가능). 따라서 싱글톤 객체는 공유되는 필드를 가져서는 안 된다.




