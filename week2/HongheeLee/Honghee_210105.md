## 컴포넌트 스캔

### 컴포넌트 스캔과 의존관계 자동 주입 시작하기

스프링 빈 등록하는 방법은 직접 자바코드에 @Bean 붙이며 설정 정보에 직접 등록할 수도 있지만,  스프링은 설정 정보가 없어도 자동으로 스프링 빈을 등록하는 **컴포넌트 스캔**이라는 기능 제공 + 의존관계도 자동으로 주입하는 **@Autowired** 기능 제공.

이를 사용하려면 설정정보에 @ComponentScan를 붙이면 된다. 

그런데 AppConfig와 달리 설정 정보 자체가 없기 때문에 의존관계 주입도 이 클래스 안에서 해결해야 한다. 이를 위해서 @Autowired를 생성자에 붙이는데 의존관계를 자동으로 주입해준다. 

AnnotationConfigApplicationContext를 사용하는건 AppConfig로 할 때랑 같지만 넘겨주는 설정 정보가 AutoAppConfig로 다르다. 로그를 확인하면 스프링 빈 등록과 의존관계 주입을 확인할 수 있다.

진행 과정

1. @ComponentScan은 @Component가 붙은 모든 클래스를 스프링 빈으로 등록한다. 이때 스프링 빈의 이름은 맨 앞글자를 소문자로 한 클래스명이다. 
2. @Autowired 의존관계 자동주입. 생성자에 @Autowired 지정하면 스프링 컨테이너가 자동으로 해당 스프링 빈을 찾아서 주입한다. 이때 기본 조회 전략은 타입이 같은 빈을 찾아서 주입하는 것.

### 탐색 위치와 기본 스캔 대상

basePackages로 탐색할 패키지의 시작 위치를 지정할 수 있다. 이 패키지를 포함해서 하위 패키지를 모두 탐색한다. 지정하지 않으면 모든 자바 코드 다 뒤져서 오래 걸리니까. 지정하지 않으면 @ComponentScan이 붙은 설정 정보 클래스의 패키지가 시작위치가 된다. 

**권장 : 패키지 위치를 지정하지 않고 설정 정보 클래스의 위치를 프로젝트 최상단에 둔다**

@Component, @Controller, @Service, @Repository, @Configuration을 컴포넌트 스캔의 대상으로 삼는다. 

### 필터

- includeFilters : 컴포넌트 스캔 대상을 추가로 지정한다.
- excludeFilters : 컴포넌트 스캔에서 제외할 대상을 지정한다.

FilterType은 5가지 옵션이 있다. ANNOTATION(기본값), ASSIGNABLE_TYPE, ASPECTJ, REGEX, CUSTOM. 

하지만 @Component면 충분하기 때문에 필터를 사용할 일은 많지 않다. 스프링의 기본 설정에 맞추어 사용하는 것을 권장.

### 중복 등록과 충돌

컴포넌트 스캔에서 같은 빈 이름 등록하면?

1. 자동 빈 등록 vs 자동 빈 등록

   ConflictingBeanDefinitionException 예외 발생

2. 수동 빈 등록 vs 자동 빈 등록

   수동 빈 등록이 우선권을 가진다. 수동 빈이 자동 빈을 오버라이딩한다. 하지만 최근 스프링 부트에서는 수동 빈 등록과 자동 빈 등록이 충돌하면 오류가 발생하도록 기본값 변경했다. 

## 의존관계 자동 주입

### 다양한 의존관계 주입 방법

생성자 주입 / 수정자 주입(setter 주입) / 필드 주입 / 일반 메서드 주입, (@Autowired 어디에 붙일거냐?)

1. 생성자 주입

생성자를 통해서 의존 관계 주입 받는 방법. 

생성자 호출 시점에 1번만 호출되는 것이 보장된다.  **불변, 필수** 의존관계에 사용.

**생성자가 딱 1개만 있으면 @Autowired를 생략해도 자동 주입된다.**

2. 수정자 주입

필드 값을 변경하는 setter(수정자 메서드)를 통해서 의존관계를 주입하는 방법.

**선택, 변경** 가능성이 있는 의존관계에 사용. 

3. 필드 주입

필드에 바로 주입하는 방법. 코드는 간결하지만 외부에서 변경이 불가능해서 테스트하기 어려움. DI 프레임워크가 없으면 아무것도 할 수 없다. 테스트 코드 정도 말고는 사용하지 말자!!!

4. 일반 메서드 주입

일반 메서드를 통해서 주입.  한번에 여러 필드를 주입받을 수 있지만 일반적으로 사용 X

### 옵션 처리

주입할 스프링 빈이 없어도 동작해야할 때가 있는데 @Autowired만 사용하면 자동 주입 대상이 없으면 오류가 발생. required 옵션의 기본값이 true이기 때문에.

처리 방법

- @Autowired(required=false) : 자동 주입할 대상이 없으면 수정자 메서드 자체가 호출 안됨
- org.springframework.lang.@Nullable : 자동 주입할 대상이 없으면 null이 입력된다.
- Optional<> : 자동 주입할 대상이 없으면 Optional.empty 가 입력된다.

### 생성자 주입을 선택해라!!

최근에는 스프링을 포함한 대부분이 생성자 주입을 권장한다.

**불변** -> 대부분의 의존관계 주입은 한 번 일어나면 애플리케이션 종료 시점까지 의존관계 변경할 일이 없기 때문에. 수정자 주입으로 하면 누군가 실수로 변경할 수도 있고 변경하면 안되는 걸 열어두면 안됨. 

**누락** ->  프레임워크 없이 순수한 자바 코드를 단위 테스트할 때 어떤 값을 필수로 주입해야 하는지 알 수 있다. 

**final 키워드** -> 필드에서 사용할 수 있다. 생성자에서 값이 설정되지 않는 오류를 컴파일 시점에 막아준다. 
