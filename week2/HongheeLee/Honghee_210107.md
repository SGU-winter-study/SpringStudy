## 빈 생명주기 콜백

### 빈 생명주기 콜백 시작

객체의 초기화와 종료작업이 필요하다. 스프링을 통해 어떻게?

스프링 빈의 라이프 사이클은 객체생성 -> 의존관계 주입 

스프링 빈의 이벤트 사이클은 스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸전 콜백 -> 스프링 종료

객체 생성하고 의존관계 주입이 끝나고 나서 초기화 작업을 해야하니까, 그리고 안전하게 종료 작업을 해야하니까 스프링이 **초기화 콜백**, **소멸전 콜백**을 준다.

생성자로 다 하면 되지 않나? 

객체의 생성과 초기화를 분리하자. 생성자는 필수 정보를 받고 메모리를 할당해 객체를 생성하는 책임. 초기화는 생성된 값을 활용해서 외부 커넥션을 연결하는 등의 무거운 동작 수행. 명확하게 나누는게 유지보수에 좋다!

스프링은 3가지 방법으로  빈 생명주기 콜백을 지원함.

### 인터페이스 InitializingBean, DisposableBean

InitializingBean 은 afterPropertiesSet() 메서드로 초기화를 지원한다.

DisposableBean 은 destroy() 메서드로 소멸을 지원한다.

스프링 초창기 방법이라 거의 사용하지 않고 지금은 더 나은 다른 방법 주로 사용한다.

단점:  코드가 스프링 전용 인터페이스에 의존한다. 초기화, 소멸 메서드의 이름을 변경할 수 없다. 코드 못 고치는 외부 라이브러리에 적용할 수 없다. 

### 빈 등록 초기화, 소멸 메서드

설정 정보에 @Bean(initMethod = "init", destroyMethod = "close") 처럼 초기화, 소멸 메서드를 지정할 수 있다.

특징

- 메서드 이름을 자유롭게 줄 수 있다. 

- 스프링 빈이 스프링 코드에 의존적이지 않다. 

- 설정 정보를 사용하기 때문에 외부 라이브러리에도 초기화, 종료 메서드를 적용할 수 있다.

종료 메서드 추론 : @Bean의 destoryMethod의 기본값이 (inferred)로 등록 되어 있어서 close, shutdown라는 이름의 메서드를 자동으로 호출해준다. 

### 애노테이션 @PostConstruct, @PreDestory

@PostConstruct, @PreDestory 애노테이션을 사용하면 가장 편리하게 초기화와 종료를 실행할 수 있다. **그냥 이거 사용하자!**

특징

- 스프링에서 가장 권장하는 방법, 애노테이션만 붙이면 돼서 편리
- 자바 표준이라 다른 컨테이너에서도 동작하고, 컴포넌트 스캔과도 잘 어울린다.
- 외부 라이브러리에는 적용하지 못해서 @Bean의 기능을 사용해야 한다.


## 빈 스코프

스코프 : 빈이 존재할 수 있는 범위

스코프 종류

- **싱글톤** : 기본 스코프. 스프링 컨테이너의 시작부터 종료까지 유지되는 가장 넓은 범위의 스코프.
- **프로토타입**: 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 짧은 범위의 스코프. 
- 웹 관련 스코프 
  - **request** : 웹 요청이 들어오고 나갈 때까지 유지되는 스코프
  - session : 웹 세션이 생성되고 종료될 때까지 유지되는 스코프
  - application : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

빈 스코프는 @Component 위에 @Scope("~~~")로 지정해준다.

### 프로토타입 스코프

프로토타입 스코프를 스프링 컨테이너에 조회하면 스프링 컨테이너는 항상 새로운 인스턴스를 생성해 반환한다. 프로토타입 빈 요청과정은 아래와 같다.

1. 프로토타입 스코프의 빈을 스프링 컨테이너에 요청한다.
2. 스프링 컨테이너는 이 시점에 프로토타입 빈을 생성하고, 필요한 의존관계를 주입한다.
3. 스프링 컨테이너는 생성한 프로토타입 빈을 클라이언트에 반환한다.
4. 이후에 스프링 컨테이너에 같은 요청이 오면 항상 새로운 프로토타입 빈을 생성해서 반환한다.

스프링 컨테이너는 프로토타입 빈을 생성, 의존관계 주입, 초기화까지만 처리한다. 클라이언트에 빈을 반환한 이후에 그 빈을 관리할 책임(종료 메서드 호출 등)은 클라이언트에 있다. 
@PreDestory 종료 메서드 호출 X. 이름 그대로 프로토타입이라 만들고 버린다. 
