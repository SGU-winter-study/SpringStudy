<h1>스프링 핵심원리 - 7일차(빈 스코프) </h1>

* 빈 스코프 : 말 그대로, 빈이 존재할 수 있는 범위(빈이 언제까지 영향을 미치는 가로 이해.)
* 빈 스코프의 종류: 싱글톤, 프로토타입, 웹 관련 스코프(request, session, application)
* 스코프 지정 : @Scope 어노테이션을 통해서 자동(@Component) 또는 수동(@Bean)등록 가능.

## 1. 프로토타입 스코프

* 프로토타입 스코프 : 프로토타입 스코프는 스프링 컨테이너에 조회시 항상 새로운 인스턴스를 생성해서 받아옴.

- 스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화 까지만 처리한다.

- "관리"를 컨테이너가 하지않기 때문에, 당연히 소멸자(@PreDestory)가 호출 되지 않는다.

- 그렇다면 언제 프로토타입 스코프가 필요할까?
   -> 매번 새로운 오브젝트가 필요하면서 DI를 통해 다른 빈을 이용해야 할 경우 사용한다.

## 2. 프로토타입 스코프 적용

- 싱글톤 빈과 프로토타입 스코프를 우리가 이때까지 배운 내용으로만 구현을 하면, 사용할때마다 새로운 객체가
  생성되지 않는다. -> 요청할 때마다 새로운 객체가 만들어지게 하려면 다른 방법이 필요하다.

-> Provider를 사용해서 요청할때마다 새로운 객체가 만들어지도록 할 수 있다.

* ObjectFactory / ObjectProvider
- 지정한 빈을 컨테이너에서 "대신" 찾아주는 DL서비스를 제공한다. ObjectProvide는 ObjectFatory의 확장버전.
- getObject()를 호출하는 것을 통해 빈을 찾아서 반환시켜준다.
- 스프링에 의존적이여서 외부에서 사용이 불가능하다.

* JSR-330 Provider
- 자바표준으로 스프링에 의존적이지 않고, 외부에서 사용이 가능하다.
- Provider는 최소기능만 제공하고, get()을 호출해서 빈을 반환한다.

* 정리
- 스프링이 아닌 다른 컨테이너에서 사용해야하는 경우가 아니면 ObjectProvider를 사용한다.

## 3. 웹스코프

* 웹스코프 : 웹 환경에서만 동작하고 스코프의 종료시점까지 관리가 된다.(웹 어플리케이션 제작을 위한 스코프)

* 웹스코프의 종류 : Request(HTTP Request), Session(HTTP Session), Application(Servelet), WebSocket(웹소켓)
 
* Request 스코프의 목적 - 동시에 여러 HTTP Request가 왔을 때, 어떤 요청이 남긴 로그인지 알아보기 쉽게한다.(UUID)
                       - 파라미터를 통해 정보를 넘길경우 웹기술에 종속되고, 코드가 지저분해지는 문제점을 해결한다.

* 웹스코프 적용
    1. Provider 이용하기 -> ObjectProvider, getObject()를 통해 request scope 빈 생성을 지연(빈에 request하는 것을 지연)할 수 있다.
                        -> 같은 Http 요청일 경우 딜레이가 되더라도 같은 스프링 빈을 반환해주고, 이를 알아보기 쉬워진다.
    
    2. 프록시 방식 -> 가짜 프록시 클래스를 만들고 이를 통해 요청이 오면 진짜빈을 요청한다.(위임 로직)
                   -> 이를 통해 원본을 거치지 않고 동일하게 사용할 수 있다.
                   -> 거의 싱글톤 처럼 동작한다.(싱글톤은 아님)

    3. 결론 : Provider/프록시를 통해 객체 조회를 필요한 시점까지 지연시킬수 있다. 대부분의 경우 Provider를 이용하고, 꼭 필요할때 프록시 사용. 