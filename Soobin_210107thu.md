# 의존관계 자동 주입
## 다양한 의존관계 주입 방법
스프링 컨테이너는 크게 1) 스프링 빈을 생성하는 단계 2) 의존관계를 주입하는 단계의 두 단계로 나눠지게 된다.

의존관계 주입(DI, Dependency Injection)에는 크게 4가지 방법이 있다.
* 생성자 주입
* 수정자 주입(setter 주입)
* 필드 주입
* 일반 메소드 주입

각각에 대하여 자세히 알아보면 다음과 같다.
※ 의존관계 자동 주입은 스프링 컨테이너에 의해 관리되는 스프링 빈이어야지만 동작한다.

1. 생성자 주입
생성자에 @Autowired를 붙임으로써 생성자를 통해서 의존 관계를 주입하는 방법. ComponentScan을 통해 스프링 컨테이너에 @Component annotation이 붙은 클래스가 등록이 될 때, 생성자가 호출되면 스프링 컨테이너에서 Bean을 꺼내 주입해줌으로써 의존관계를 주입한다.
	- 생성자가 호출되는 시점에 주입되므로 단 1번만 호출되는 것이 보장된다.
	- 불변, 필수 의존관계에 주로 사용된다.
	- 스프링 빈에서 생성자가 한 개만 존재하는 경우 @Autowired가 없어도 스프링에서 알아서 의존관계를 주입해준다.

2. 수정자 주입
setter라는 수정자 메소드를 통해 의존관계를 주입하는 방법이다.
스프링 빈으로 등록하면서 동시에 의존관계 주입까지 한번에 일어나게 되는 생성자 주입과 달리(스프링 빈에 등록하기 위해서는 반드시 생성자를 호출해야 하므로), 수정자 주입은 스프링 빈으로 등록되는 단계와 분리된다.
	- 1회 이상 호출될 수 있다.
	- 선택적, 변경 가능성이 있는 의존관계에서 주로 사용된다.

3. 필드 주입
필드에 의존관계를 바로 주입하는 방법이다.
```java
@Autowired private MemberRepository memberRepository
@Autowired private DiscountPolicy discountPolicy
```
코드가 간결하고 좋아 보이지만, 외부에서의 변경이 불가능하기 때문에 테스트가 힘들고, 따라서 권장되지 않는 방식이다(안티 패턴). 새로운 객체를 생성하여 의존관계를 주입하고싶어도 수정자(setter)를 다시 만들지 않는 이상 불가능하다. 즉 DI프레임워크가 없으면 아무것도 할 수 없다.
	- 실제 환경에서 사용할 일이 없는 테스트 코드에서 사용된다.
	- @Configuration 클래스에서 간혹 사용하기도 한다.(스프링에서만 사용할 것이기 때문)

4. 일반 메소드 주입
일반 메소드(생성자, 수정자 등이 아닌 메소드)를 통해 의존관계를 주입하는 방법이다.
한 번에 여러 필드를 주입할 수 있지만 잘 사용하지는 않는다.


## 생성자 주입의 장점
대부분의 DI 프레임워크에서는 생성자 주입이 권장되는데, 그 이유는 다음과 같다.
- 불변
대부분의 의존관계는 애플리케이션 종료 시점까지 변경하게 될 일이 별로 없다. 오히려 변하면 안 되는 경우가 대부분이다. 그리고 수정자 주입을 사용하게 되면 setter를 public으로 열어두어야 한다는 위험성이 수반된다. 생성자 주입을 사용하는 경우 객체 생성 타이밍에 딱 한 번만 호출되기 때문에 의존관계가 불변하게 설계할 수 있다.
- 누락
주입 데이터를 누락했을 때 컴파일 오류가 발생하기 때문에 어떤 값을 주입해야 하는지 바로 알 수 있다(컴파일 시점에서 발견할 수 있기 때문에 해결이 용이하다). 이는 생성자 주입을 사용하는 경우 필드에 final 키워드를 사용할 수 있기 때문에 가능한 것이다.

=> 프레임워크에 의존하지 않고 순수 Java 언어의 특징을 잘 살리는 방법이다.


## 조회 빈이 2개 이상인 경우
@Autowired 를 통해 스프링 빈을 조회할 때는 타입으로 찾아내는 방식을 사용한다. 이 때, 동일한 타입의 스프링 빈이 2개 이상인 경우에는 충돌이 발생한다. 이를 해결할 수 있는 대표적인 방법들은 다음과 같다.


##### @Autowired 필드 명
@Autowired의 기능 중 하나로, 조회 대상으로 매칭된 빈이 2개 이상 존재하는 경우 필드 이름이나 파라미터 이름을 빈 이름과 비교하는 것으로 추가 매칭 조건으로 걸 수 있는 것이 존재한다.
즉,
1) 타입 매칭을 수행하고
2) 타입 매칭 결과가 여러 개 존재하는 경우, 필드 명 또는 파라미터 명으로 빈 이름을 매칭하여 조회한다.

##### @Qualifier
추가적인 조회조건을 붙여주는 방식이다. 
```java
@Bean
@Qualifier("mainDiscountPolicy")
public DiscountPolicy discountPolicy() {
	...
}
```
위와 같이 정의된 스프링 빈이 있다면, @Qualifier("mainDiscountPolicy")를 이용하여 조회가 가능하다. 일종의 검색에 걸리게 하기 위한 태그를 붙이는 것이다.
만약 해당 Qualifier를 찾지 못하는 경우 주어진 Qualifier 이름으로 스프링 빈을 찾는다. (그러나 이런 현상이 발생하지 않도록 하는 것이 좋다.)

##### @Primary
우선순위를 지정함으로써 여러 개의 매칭 빈 중 하나를 선정하는 방식이다. @Primary가 붙은 빈이 선택되게 된다.
