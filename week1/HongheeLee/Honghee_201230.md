## 섹션 6 스프링 DB 접근 기술

단계별로 개선해서 개발해본다. 

1. 순수 JDBC로 개발

2. 스프링이 제공하는 Jdbctemplate 활용해 sql  쿼리 사용

3. JPA를 활용해 쿼리 없이 객체를 DB에 저장

4. JPA를 편리하게 사용할 수 있도록 감싸는 기술 -> 스프링 데이터 JPA 활용

   

- Jdbc

  옛날 사람들은 하나하나 길게 코드 쳐가면서 이렇게 개발했다. 지금은 이렇게 하지는 않음.

  기존의 코드 손대지 않고 config 파일만 수정해서 메모리에 저장하는 방식에서 DB에 저장하는 방식으로 바꿀 수 있음.

  스프링의 장점을 보여준다. 다형성을 편리하게 구현할 수 있도록 스프링 컨테이너가 도와줌. DI 사용.

  개방 폐쇄 원식(OCP) : 확장에는 열려있고, 수정(변경)에는 닫혀있다. (객체 지향에서 말하는 다형성을 잘 활용하면 이를 얻을 수 있다.)

  테스트 코드에서 

  - @SpringBootTest : 스프링 컨테이너와 테스트를 함께 실행한다. 

  - @Transactional 테스트 케이스에 달면 테스트 시작 전에 트랜잭션을 시작하고  DB에 쿼리 날리고 다 해서 테스트 마치고 트랜잭션을  롤백한다. 커밋하기 전에는 DB에 반영이 안되기 때문에 다음 테스트에 영향 X.
  - 단위 테스트(자바 코드로만)와 통합 테스트(스프링 컨테이너까지 올리는)가 있는데 테스트는 단위 테스트를 잘 쪼개서 만드는게 좋다.

- JdbcTemplate

  JDBC의 반복 코드를 대부분 제거해준다. SQL은 직접 작성해야한다. 

- JPA

  반복코드와 sql 다 만들어주고 객체 중심의 설계로 패러다임을 변경해준다. 개발 생산성 크게 증가!

  JPA vs 마이바티스

  객체와 ORM (Objection, Relation Database를 매핑한다.) 

  어노테이션을 통해 데이터베이스와 필드를 매핑한다. JPA를 활용하려면 EntityManager를 주입받아야 한다.

- 스프링 데이터 JPA

   스프링 부트와 JPA만 사용해도 개발 생산성이 많이 증가하는데 스프링 데이터 JPA까지 더하면 중복을 확연히 줄이고 인터페이스만으로 개발할 수도 있다.  하지만 JPA를 편리하게 도와주는 도구이니까 JPA를 먼저 학습해야함!

  스프링데이터 JPA가 구현체를 알아서 만들어주고 스프링빈을 자동적으로 등록해준다. JpaRepository나 CrudRepository에 findAll. save 등의 기본적인 메소드들은 이미 구현되어 제공되고 있음. 인터페이스로 공통화할 수 없는 기능은 규칙에 따라 적어주면 JPQL로 알아서 바꿔준다. 

  동적쿼리는 Querydsl이라는 라이브러리를 사용하면 된다. 언젠가 배울날이....!!!

  ---

  ## 섹션 7 AOP

  AOP 이론적으로 처음 배우면 멘붕에 빠지기 쉽다... 마치 C언어의 포인터 처음 배울 때처럼.

  언제 필요한지가 중요하다! 그 다음 차례차례 배우면 되지.

  공통 관심 사항 vs 핵심 관심 사항

  예를 들어 모든 메소드의 시간을 측정하려고 하면 하나하나 로직을 추가해주어야 하는데 그러다 보면 핵심 비즈니스 로직과 시간 측정 로직이 섞여 여러 문제가 발생한다. 그때 필요한 것이 AOP!

  AOP: 관점 지향 프로그래밍, 공통 관심사항과 핵심 관심 사항을 분리시킨다. 원하는 곳에 공통 관심 사항 적용. 프록시 기술을 활용해 작동한다. 

---

